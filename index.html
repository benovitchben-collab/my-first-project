<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–ö–°-–±–æ—Ç</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            transition: all 0.3s ease;
        }
        .telegram-theme {
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .button-primary {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .button-secondary {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
        }
        input, select {
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
            border: 1px solid var(--tg-theme-hint-color, #cccccc);
        }
    </style>
</head>
<body class="telegram-theme min-h-screen flex flex-col items-center justify-between p-4">
    <div id="app" class="w-full max-w-md">
        <h1 class="text-2xl font-bold text-center mb-4">üè† –ú–ö–°-–±–æ—Ç üì°</h1>
        <div id="message" class="mb-4 text-center"></div>
        <div id="main-menu" class="space-y-2"></div>
        <div id="form-container" class="space-y-4 hidden">
            <div id="form-message" class="text-center"></div>
            <input id="input-field" type="text" class="w-full p-2 rounded" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ">
            <select id="select-field" class="w-full p-2 rounded hidden">
                <option value="–ü–∞—Å–ø–æ—Ä—Ç">üìÑ –ü–∞—Å–ø–æ—Ä—Ç</option>
                <option value="–ò–ù–ù">üßæ –ò–ù–ù</option>
                <option value="–°–ù–ò–õ–°">üü¢ –°–ù–ò–õ–°</option>
            </select>
            <div id="form-buttons" class="space-y-2"></div>
        </div>
        <div id="faq-container" class="space-y-2 hidden"></div>
        <div id="additional-services" class="space-y-2 hidden"></div>
    </div>
    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // State management
        let state = {
            current: null,
            data: {
                fullname: '',
                phone: '',
                document_type: '',
                document_number: ''
            }
        };

        // DOM elements
        const app = document.getElementById('app');
        const message = document.getElementById('message');
        const mainMenu = document.getElementById('main-menu');
        const formContainer = document.getElementById('form-container');
        const formMessage = document.getElementById('form-message');
        const inputField = document.getElementById('input-field');
        const selectField = document.getElementById('select-field');
        const formButtons = document.getElementById('form-buttons');
        const faqContainer = document.getElementById('faq-container');
        const additionalServices = document.getElementById('additional-services');

        // Helper functions
        function showMessage(text) {
            message.innerHTML = text;
        }

        function createButton(text, onClick, isPrimary = true) {
            const button = document.createElement('button');
            button.className = `w-full p-2 rounded ${isPrimary ? 'button-primary' : 'button-secondary'} hover:opacity-90 transition`;
            button.textContent = text;
            button.onclick = onClick;
            return button;
        }

        function clearForm() {
            inputField.value = '';
            selectField.classList.add('hidden');
            inputField.classList.remove('hidden');
            formButtons.innerHTML = '';
            formMessage.innerHTML = '';
        }

        function showMainMenu() {
            state.current = 'main';
            formContainer.classList.add('hidden');
            faqContainer.classList.add('hidden');
            additionalServices.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            showMessage('üè† –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–ö–°-–±–æ—Ç! üì° –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏ –ª–µ–≥–∫–æ –∏ –±—ã—Å—Ç—Ä–æ! üåê');
            mainMenu.innerHTML = '';
            [
                { text: 'üìù –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', action: startForm },
                { text: 'üîÑ –ü–æ–º–µ–Ω—è—Ç—å —Ç–∞—Ä–∏—Ñ', action: showUnauthorized },
                { text: 'üí≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å', action: showUnauthorized },
                { text: 'üí∏ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å', action: showUnauthorized },
                { text: 'üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏', action: showAdditionalServices }
            ].forEach(item => mainMenu.appendChild(createButton(item.text, item.action)));
        }

        function showUnauthorized() {
            mainMenu.classList.add('hidden');
            formContainer.classList.remove('hidden');
            clearForm();
            showMessage('–ú—ã –Ω–µ –º–æ–∂–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ, —Ç–∞–∫ –∫–∞–∫ –≤—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å. ‚ö†Ô∏è');
            formButtons.appendChild(createButton('üîê –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è', startForm));
            formButtons.appendChild(createButton('‚Ü©Ô∏è –°–º–µ–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ', showMainMenu, false));
        }

        function showAdditionalServices() {
            state.current = 'additional';
            mainMenu.classList.add('hidden');
            additionalServices.classList.remove('hidden');
            showMessage('üõ†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é: üåê');
            additionalServices.innerHTML = '';
            [
                { text: '‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã', action: showFAQ },
                { text: '‚ÑπÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', action: showInstruction },
                { text: 'üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π', action: contactSupport },
                { text: '‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', action: showMainMenu }
            ].forEach(item => additionalServices.appendChild(createButton(item.text, item.action, item.text !== '‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥')));
        }

        function showFAQ() {
            state.current = 'faq';
            additionalServices.classList.add('hidden');
            faqContainer.classList.remove('hidden');
            showMessage('‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã: üåê');
            faqContainer.innerHTML = '';
            [
                { text: '‚è≥ –î–æ –∫–∞–∫–æ–≥–æ —á–∏—Å–ª–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è?', msg: 'üìå –ü–æ–∫–∞–∑–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–æ 25 —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞. üì°' },
                { text: 'üí∏ –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–æ–≤—Ä–µ–º—è?', msg: '‚ö†Ô∏è –ü–ª–∞—Ç–∞ –±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∞ –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É ‚Äî –∏—Å—Ö–æ–¥—è –∏–∑ –ø–æ–∫–∞–∑–∞–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª–≥–æ–¥–∞. ‚ö°Ô∏è' },
                { text: 'üîí –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?', msg: 'üîí –î–∞, —É –Ω–∞—Å —Å—Ç–æ–∏—Ç –∑–∞—â–∏—Ç–∞ VISION 3.87676 PRO VS (—Å–∫–≤–æ–∑–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ). üåê' },
                { text: '‚ö°Ô∏è –ü–æ—á–µ–º—É —á–µ—Ä–µ–∑ Telegram?', msg: '‚ö°Ô∏è –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏. üì°' },
                { text: 'üîÅ –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É?', msg: '‚úÖ –î–∞, –º–æ–∂–Ω–æ. –°–≤—è–∂–∏—Ç–µ—Å—å —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥. üåê' },
                { text: 'üìë –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?', msg: 'üëâ –ü–∞—Å–ø–æ—Ä—Ç, –ò–ù–ù, –°–ù–ò–õ–°. üì°' },
                { text: '‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', action: showAdditionalServices }
            ].forEach(item => {
                faqContainer.appendChild(createButton(item.text, () => {
                    if (item.msg) showMessage(item.msg);
                    else item.action();
                }, !item.action));
            });
        }

        function showInstruction() {
            showMessage('üìã –ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:\n1Ô∏è‚É£ –ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ¬ª.\n2Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.\n3Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–æ–º–µ—Ä.\n4Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ. üåê\n\n–ù–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–∂–∞—Ç—å "‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥". üì°');
            formContainer.classList.remove('hidden');
            clearForm();
            formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', showAdditionalServices, false));
        }

        function contactSupport() {
            tg.openLink('https://t.me/MyMKCsup');
        }

        async function saveData() {
            const timestamp = new Date().toISOString().replace('T', ' ').slice(0, 19);
            const userId = tg.initDataUnsafe.user?.id || 'unknown';
            const username = tg.initDataUnsafe.user?.username || '';
            const userWithBot = username ? `@${username} (–ú–ö–°)` : '(–ú–ö–°)';
            const record = `${timestamp}\t${userId}\t${userWithBot}\t${state.data.fullname}\t${state.data.phone}\t${state.data.document_type} ${state.data.document_number}\n`;

            try {
                // Simulate saving to a server
                console.log('Saving:', record);
                // In a real app, use axios to send to a backend
                // await axios.post('/save', { data: record });
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function startForm() {
            state.current = 'fullname';
            mainMenu.classList.add('hidden');
            formContainer.classList.remove('hidden');
            clearForm();
            formMessage.innerHTML = '<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>';
            inputField.placeholder = '–í–≤–µ–¥–∏—Ç–µ –§–ò–û –ø–æ–ª–Ω–æ—Å—Ç—å—é';
            formButtons.appendChild(createButton('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', submitFullname));
            formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', showMainMenu, false));
        }

        async function submitFullname() {
            const text = inputField.value.trim();
            if (!/^[–ê-–Ø–∞-—è–Å—ë\s-]+$/.test(text)) {
                formMessage.innerHTML = '‚ùå –§–ò–û –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. ‚ö†Ô∏è';
                return;
            }
            state.data.fullname = text.replace(/\s+/g, ' ');
            await saveData();
            state.current = 'phone';
            clearForm();
            formMessage.innerHTML = '<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>';
            inputField.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (+79991234567)';
            formButtons.appendChild(createButton('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', submitPhone));
            formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', showMainMenu, false));
        }

        async function submitPhone() {
            const phone = inputField.value.trim();
            const digits = phone.replace(/[^0-9]/g, '');
            if (!phone.startsWith('+7') && !phone.startsWith('7')) {
                formMessage.innerHTML = '‚ùå –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å +7 –∏–ª–∏ 7. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. ‚ö†Ô∏è';
                return;
            }
            if (digits.length < 10 || digits.length > 11) {
                formMessage.innerHTML = '‚ùå –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 11 —Ü–∏—Ñ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. ‚ö†Ô∏è';
                return;
            }
            state.data.phone = phone;
            await saveData();
            state.current = 'document_type';
            clearForm();
            formMessage.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç: üåê';
            selectField.classList.remove('hidden');
            inputField.classList.add('hidden');
            formButtons.appendChild(createButton('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', submitDocumentType));
            formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', () => {
                state.current = 'phone';
                clearForm();
                formMessage.innerHTML = '<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>';
                inputField.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (+79991234567)';
                formButtons.appendChild(createButton('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', submitPhone));
                formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', showMainMenu, false));
            }, false));
        }

        async function submitDocumentType() {
            state.data.document_type = selectField.value;
            await saveData();
            state.current = 'document_number';
            clearForm();
            formMessage.innerHTML = '<b>–£–ö–ê–ó–´–í–ê–ô–¢–ï –¢–û–õ–¨–ö–û –°–í–û–ò –î–ê–ù–ù–´–ï</b>';
            inputField.placeholder = `–í–≤–µ–¥–∏—Ç–µ ${state.data.document_type} (–ø—Ä–∏–º–µ—Ä: ${state.data.document_type === '–ü–∞—Å–ø–æ—Ä—Ç' ? '4510 123456' : state.data.document_type === '–ò–ù–ù' ? '500100732259' : '112-233-445 95'})`;
            formButtons.appendChild(createButton('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', submitDocumentNumber));
            formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', () => {
                state.current = 'document_type';
                clearForm();
                formMessage.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç: üåê';
                selectField.classList.remove('hidden');
                inputField.classList.add('hidden');
                formButtons.appendChild(createButton('–û—Ç–ø—Ä–∞–≤–∏—Ç—å', submitDocumentType));
                formButtons.appendChild(createButton('‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥', showMainMenu, false));
            }, false));
        }

        async function submitDocumentNumber() {
            state.data.document_number = inputField.value.trim();
            await saveData();
            showMessage('‚ùóÔ∏è–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥‚ùóÔ∏è\n–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã —á–µ–ª–æ–≤–µ–∫, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã –≤–µ—Ä–Ω–µ—Ç–µ—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é! üëá');
            formContainer.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            mainMenu.innerHTML = '';
            mainMenu.appendChild(createButton('–Ø –Ω–µ —Ä–æ–±–æ—Ç ‚úÖ', () => {
                tg.openLink('https://redirect.figma.site/');
                showMainMenu();
            }));
            state.data = { fullname: '', phone: '', document_type: '', document_number: '' };
        }

        // Initialize
        showMainMenu();
    </script>
</body>
</html>
